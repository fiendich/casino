<!DOCTYPE html>
<html>
<head>
    <title>Casino</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav>
        <a href="/" id="homeButton"><img src="/static/images/logo/SigmaSpin.png"></a>
        
        {% if session.get("user_id") %}
            <!-- Authenticated: show username and logout -->
            <div class="nav-right">
                <span id="navUsername">{{ username }}</span>
                <a href="/logout" id="logoutButton">Logout</a>
            </div>
        {% else %}
            <!-- Not authenticated: show login and register buttons -->
            <div class="nav-right">
                <button id="loginNavButton" onclick="openAuthModal('login')">Login</button>
                <button id="registerNavButton" onclick="openAuthModal('register')">Register</button>
            </div>
        {% endif %}
    </nav>  

    <div class="content">
        {% block content %}{% endblock %}
    </div>

    <!-- Toast container for alerts -->
    <div id="toast-container"></div>

    <!-- Auth Modal (Login/Register) -->
    {% if not session.get("user_id") %}
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeAuthModal()">&times;</span>
            
            <div class="modal-tabs">
                <button class="tab-button active" data-tab="login">Login</button>
                <button class="tab-button" data-tab="register">Register</button>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="tab-content active">
                <h2>Login</h2>
                <form method="POST" action="/login">
                    <input type="text" name="username" placeholder="Username" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
            </div>

            <!-- Register Form -->
            <div id="registerForm" class="tab-content">
                <h2>Register</h2>
                <form method="POST" action="/register">
                    <input type="text" name="username" placeholder="Username" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit">Register</button>
                </form>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Global scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/static/js/utils.js"></script>
    
    <script>
        // Modal functions
        function openAuthModal(tab = 'login') {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.style.display = 'flex';
                switchTab(tab);
            }
        }

        function closeAuthModal() {
            const modal = document.getElementById('authModal');
            if (modal) {
                modal.style.display = 'none';
                // Remove modal param from URL
                const url = new URL(window.location);
                url.searchParams.delete('modal');
                url.searchParams.delete('tab');
                window.history.replaceState({}, '', url);
            }
        }

        function switchTab(tabName) {
            // Remove active from all tabs and contents
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active to selected tab
            const tabButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            const tabContent = document.getElementById(`${tabName}Form`);
            
            if (tabButton) tabButton.classList.add('active');
            if (tabContent) tabContent.classList.add('active');
        }

        // Tab button click handlers
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                switchTab(this.dataset.tab);
            });
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('authModal');
            if (event.target === modal) {
                closeAuthModal();
            }
        }

        // Check URL params on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('modal') === 'auth') {
                const tab = urlParams.get('tab') || 'login';
                openAuthModal(tab);
            }
        });
    </script>
</body>
</html>